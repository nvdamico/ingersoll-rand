/*
Widget:   q4.api
Version:  1.12.0
Compiled: 2017-04-05
*/
!function(a){a.widget("q4.api",{options:{url:"",usePublic:!1,apiKey:"",limit:0,skip:0,excludeSelection:!0,fetchAllYears:!1,showAllYears:!1,allYearsText:"All",startYear:null,forceStartYear:!1,showFuture:!0,showPast:!0,tags:[],titleLength:0,bodyLength:0,shortBodyLength:0,shortTypes:{"Annual Report":"Annual","Supplemental Report":"Supplemental","First Quarter":"Q1","Second Quarter":"Q2","Third Quarter":"Q3","Fourth Quarter":"Q4"},dateFormat:"mm/dd/yy",useMoment:!1,sortAscending:!1,years:[],minYear:null,maxYear:null,minDate:null,maxDate:null,defaultThumb:"",template:"",append:!0,cssClass:null,loadingClass:null,loadingMessage:"Loading...",yearContainer:null,yearTemplate:null,yearTrigger:null,yearSelect:null,tagSelect:null,tagTrigger:null,activeClass:"active",itemContainer:null,itemTemplate:"",itemLoadingClass:null,itemLoadingMessage:null,itemNotFoundMessage:"No items found.",noYearsMessage:"",onYearChange:function(a,b){},onTagChange:function(a,b){},beforeRender:function(a,b){},beforeRenderItems:function(a,b){},beforeRenderYears:function(a,b){},itemsComplete:function(a){},complete:function(a){}},$widget:null,years:null,currentYear:-1,currentTags:[],_setOption:function(a,b){this._super(a,b),this._normalizeOptions()},_convertToArray:function(b){return"string"==typeof b&&(b=a.trim(b).split(/[\s,|]+/)),a.isArray(b)?b:[]},_convertToDate:function(a){var b=new Date(a);return"Invalid Date"==b.toString()?null:b},_normalizeOptions:function(){var a=this.options;a.url=a.url.replace(/\/$/,""),a.years=this._convertToArray(a.years).sort(function(a,b){return b-a}),a.tags=this._convertToArray(a.tags),"string"==typeof a.startYear&&a.startYear.length&&(a.startYear=parseInt(a.startYear)),a.minDate=a.minDate?this._convertToDate(a.minDate):null,a.maxDate=a.maxDate?this._convertToDate(a.maxDate):null,null===a.itemLoadingClass&&(a.itemLoadingClass=a.loadingClass),null===a.itemLoadingMessage&&(a.itemLoadingMessage=a.loadingMessage);var b=(new Date).getFullYear();a.showPast&&!a.showFuture?a.maxYear=Math.min(b,a.maxYear||b):a.showFuture&&!a.showPast&&(a.minYear=Math.max(b,a.minYear||b))},_init:function(){var b=this,c=this.options,d=this.element;if("api"==this.widgetName)throw new Error("Please use one of q4.api's child widgets.");this.contentType=this.contentTypes[this.widgetName],this._normalizeOptions(),this.$widget=c.append?a("<div>").appendTo(d):d,c.cssClass&&this.$widget.addClass(c.cssClass),c.loadingClass&&this.$widget.addClass(c.loadingClass),this.$widget.html(c.loadingMessage||""),this.currentTags=c.tags,this._getYears().done(function(a,c){b.years=b._filterYears(a),b.currentYear=b._getCurrentYear(b.years),void 0!==c?b._renderWidget(c):b._fetchItems(b.currentYear).done(function(a){b._renderWidget(a)})})},_getYears:function(){var b=this.options;if(b.fetchAllYears&&!b.limit){var c=a.Deferred();return this._fetchItems(-1).done(function(b){var d=[];a.each(b,function(b,c){a.inArray(c.year,d)==-1&&d.push(c.year)}),c.resolve(d,b)}),c}return this._fetchYears()},_filterYears:function(b){var c=this.options;return b=a.grep(b,function(b){return(!c.minYear||b>=c.minYear)&&(!c.maxYear||b<=c.maxYear)&&(!c.years.length||a.inArray(b,c.years)>-1)}),c.forceStartYear&&a.inArray(c.startYear,b)==-1&&b.push(c.startYear),b.sort(function(a,b){return b-a}),b},_getCurrentYear:function(b){var c=this.options;if(b.length){if(a.inArray(c.startYear,b)>-1)return c.startYear;if(!c.showAllYears)return b[0]}return-1},_buildParams:function(){var a=this.options,b=a.usePublic?{apiKey:a.apiKey}:{serviceDto:{ViewType:GetViewType(),ViewDate:GetViewDate(),RevisionNumber:GetRevisionNumber(),LanguageId:GetLanguageId(),Signature:GetSignature()}};return b},_callApi:function(b,c){var d=this.options;return d.usePublic?a.ajax({type:"GET",url:d.url+b,data:c,contentType:"application/json; charset=utf-8",dataType:"jsonp"}):a.ajax({type:"POST",url:b,data:JSON.stringify(c),contentType:"application/json; charset=utf-8",dataType:"json"})},_fetchYears:function(){var b=this,c=this.options,d=c.usePublic?1:0,e=a.Deferred(),f=a.grep(this.currentTags||[],function(a){return a.length>0}),g=c.usePublic?{tagList:f.join("|")}:{serviceDto:{TagList:f}};return this._callApi(this.contentType.yearsUrl[d],a.extend(!0,this._buildParams(),this.contentType.buildParams.call(this,c),g)).done(function(a){b._trigger("beforeRenderYears",null,{items:a[b.contentType.yearsResultField]}),e.resolve(a[b.contentType.yearsResultField])}),e},_fetchItems:function(b){var c=this,d=this.options,e=d.usePublic?1:0,f=a.Deferred(),g=a.grep(this.currentTags,function(a){return a.length>0}),h=d.usePublic?{pageSize:d.limit||-1,tagList:g.join("|"),includeTags:!0,year:d.fetchAllYears?-1:b,excludeSelection:d.excludeSelection?0:1}:{serviceDto:{ItemCount:d.limit||-1,StartIndex:d.skip,TagList:g,IncludeTags:!0},excludeSelection:d.excludeSelection?0:1,year:d.fetchAllYears?-1:b};return this._callApi(this.contentType.itemsUrl[e],a.extend(!0,this._buildParams(),this.contentType.buildParams.call(this,d),h)).done(function(b){var e=a.map(b[c.contentType.itemsResultField],function(a){return c.contentType.parseItem.call(c,d,a)});e=a.grep(e,function(a){return(!d.minDate||a.dateObj>=d.minDate)&&(!d.maxDate||a.dateObj<=d.maxDate)}),e.sort(function(a,b){return(b.dateObj-a.dateObj)*(d.sortAscending?-1:1)}),f.resolve(e)}),f},_truncate:function(a,b){return a?!b||a.length<=b?a:a.substring(0,b)+"...":""},_formatDate:function(b){var c=this.options,d=new Date(b),e=c.useMoment&&"undefined"!=typeof moment;if("string"==typeof c.dateFormat)return e?moment(d).format(c.dateFormat):a.datepicker.formatDate(c.dateFormat,d);if("object"==typeof c.dateFormat){var f={};for(name in c.dateFormat)f[name]=e?moment(d).format(c.dateFormat[name]):a.datepicker.formatDate(c.dateFormat[name],d);return f}},_buildTemplateData:function(b){var c=this,d=this.options,e={},f={items:[],years:[],yearsWithItems:[]};return a.each(b,function(b,d){return a.inArray(d.year,c.years)==-1||(d.year in e||(e[d.year]=[]),f.items.push(d),void e[d.year].push(d))}),d.showAllYears&&this.years.length&&f.years.push({year:d.allYearsText,value:-1,items:f.items}),a.each(this.years,function(a,b){f.years.push({year:b,value:b,items:e[b]||[]}),b in e&&f.yearsWithItems.push({year:b,value:b,items:e[b]})}),f},_renderItems:function(b){var c=this.options,d=this.element,e=a(c.itemContainer,d);this._trigger("beforeRenderItems",null,{items:b}),c.itemLoadingClass&&e.removeClass(c.itemLoadingClass),b.length?(e.empty(),a.each(b,function(a,b){e.append(Mustache.render(c.itemTemplate,b))})):e.html(c.itemNotFoundMessage||""),this._trigger("itemsComplete")},_renderWidget:function(b){var c=this,d=this.options,e=this.element,f=this._buildTemplateData(b),g=[];a.each(f.years,function(a,b){b.value==c.currentYear&&(b.active=!0,g=b.items)}),this._trigger("beforeRender",null,f),d.loadingClass&&this.$widget.removeClass(d.loadingClass),this.$widget.html(Mustache.render(d.template,f)),d.itemContainer&&d.itemTemplate&&this._renderItems(g),d.yearContainer&&d.yearTemplate&&(a(d.yearContainer,e).empty(),f.years.length?a.each(f.years,function(b,c){a(d.yearContainer,e).append(Mustache.render(d.yearTemplate,c))}):a(d.yearContainer,e).append(d.noYearsMessage)),d.yearTrigger&&a(d.yearTrigger,e).each(function(b){var e=f.years[b].value;a(this).data("year",e),a(this).click(function(b){a(this).hasClass(d.activeClass)||c.setYear(e,b)})}),d.yearSelect&&a(d.yearSelect,e).change(function(b){c.setYear(a(this).val(),b)}),d.tagSelect&&a(d.tagSelect,e).change(function(b){c.setTags(a(this).val(),b)}),d.tagTrigger&&a(d.tagTrigger,e).each(function(b){a(this).click(function(b){a(this).hasClass(d.activeClass)||c.setTags(a(this).data("tag"),b)})}),d.customSelect,this._updateYearControls(this.currentYear),this._trigger("complete")},_updateYearControls:function(b){var c=this.options,d=this.element;c.yearTrigger&&a(c.yearTrigger,d).each(function(){a(this).toggleClass(c.activeClass,a(this).data("year")==b)}),c.yearSelect&&a(c.yearSelect,d).val(b)},_updateTagControls:function(b){var c=this.options,d=this.element;c.tagTrigger&&a(c.tagTrigger,d).each(function(){a(this).toggleClass(c.activeClass,a(this).data("tag")==b)}),c.tagSelect&&a(c.tagSelect,d).val(b)},reloadYears:function(){var b=this,c=this.options,d=this.element;b._getYears().done(function(e,f){var g={years:[]};e.length?(b.years=b._filterYears(e),a.each(b.years,function(a,b){g.years.push({year:b,value:b})}),b.currentYear=g.years[0].year,a(c.yearContainer,d).empty(),a.each(g.years,function(b,e){a(c.yearContainer,d).append(Mustache.render(c.yearTemplate,e))}),b.reloadItems()):(a(c.yearContainer,d).empty(),a(c.yearContainer,d).append(c.noYearsMessage),a(c.itemContainer,d).html(c.itemNotFoundMessage||""))})},reloadItems:function(){var b=this,c=this.options,d=this.element;if(c.itemContainer&&c.itemTemplate){var e=a(c.itemContainer,d);c.itemLoadingClass&&e.addClass(c.itemLoadingClass),e.html(c.itemLoadingMessage||"")}else c.loadingClass&&this.$widget.addClass(c.loadingClass),this.$widget.html(c.loadingMessage||"");this._fetchItems(this.currentYear).done(function(a){c.itemContainer&&c.itemTemplate?b._renderItems(a):b._renderWidget(a)})},setDateRange:function(){},setYear:function(b,c){var d=this.options,e=parseInt(b);a.inArray(e,this.years)==-1&&(e=d.showAllYears?-1:this.years[0]),this._trigger("onYearChange",c,{year:e}),c&&c.isDefaultPrevented()||(this.currentYear=e,this._updateYearControls(this.currentYear),this.reloadItems())},setTags:function(a,b){a=this._convertToArray(a),this._trigger("onTagChange",b,{tags:a}),b&&b.isDefaultPrevented()||(this.currentTags=a,this._updateTagControls(this.currentTags),this.reloadYears())},contentTypes:{downloads:{itemsUrl:["/Services/ContentAssetService.svc/GetContentAssetList","/feed/ContentAsset.svc/GetContentAssetList"],yearsUrl:["/Services/ContentAssetService.svc/GetContentAssetYearList","/feed/ContentAsset.svc/GetContentAssetYearList"],itemsResultField:"GetContentAssetListResult",yearsResultField:"GetContentAssetYearListResult",buildParams:function(a){return{assetType:a.downloadType}},parseItem:function(a,b){return{title:this._truncate(b.Title,a.titleLength),url:b.FilePath,dateObj:new Date(b.ContentAssetDate),year:new Date(b.ContentAssetDate).getFullYear(),date:this._formatDate(b.ContentAssetDate),type:b.Type,fileType:b.FileType,size:b.FileSize,icon:b.IconPath,thumb:b.ThumbnailPath,tags:b.TagsList,description:this._truncate(b.Description,a.bodyLength)}}},events:{itemsUrl:["/Services/EventService.svc/GetEventList","/feed/Event.svc/GetEventList"],yearsUrl:["/Services/EventService.svc/GetEventYearList","/feed/Event.svc/GetEventYearList"],itemsResultField:"GetEventListResult",yearsResultField:"GetEventYearListResult",buildParams:function(a){return{eventSelection:a.showFuture&&!a.showPast?1:a.showPast&&!a.showFuture?0:3,eventDateFilter:a.showFuture&&!a.showPast?1:a.showPast&&!a.showFuture?0:3,includeFinancialReports:!0,includePresentations:!0,includePressReleases:!0,sortOperator:a.sortAscending?0:1}},parseItem:function(b,c){var d=this,e=new Date,f=new Date(c.StartDate),g=new Date(c.EndDate);return{title:this._truncate(c.Title,b.titleLength),url:c.LinkToDetailPage,id:c.EventId,dateObj:f,year:f.getFullYear(),date:this._formatDate(c.StartDate),endDate:this._formatDate(c.EndDate),timeZone:"0"==c.TimeZone?"":c.TimeZone,isFuture:f>e,isPast:g<e,location:c.Location,tags:c.TagsList,body:this._truncate(c.Body,b.bodyLength),webcast:c.WebCastLink,docs:a.map(c.Attachments,function(a){return{title:a.Title,url:a.Url,type:a.Type,extension:a.Extension,size:a.Size}}),speakers:a.map(c.EventSpeaker,function(a){return{name:a.SpeakerName,position:a.SpeakerPosition}}),financialReports:a.map(c.EventFinancialReport,function(a){return d.contentTypes.financials.parseItem.call(d,b,a)}),pressReleases:a.map(c.EventPressRelease,function(a){return d.contentTypes.news.parseItem.call(d,b,a)}),presentations:a.map(c.EventPresentation,function(a){return d.contentTypes.presentations.parseItem.call(d,b,a)})}}},financials:{itemsUrl:["/Services/FinancialReportService.svc/GetFinancialReportList","/feed/FinancialReport.svc/GetFinancialReportList"],yearsUrl:["/Services/FinancialReportService.svc/GetFinancialReportYearList","/feed/FinancialReport.svc/GetFinancialReportYearList"],itemsResultField:"GetFinancialReportListResult",yearsResultField:"GetFinancialReportYearListResult",buildParams:function(a){return{reportTypes:a.reportTypes.join("|"),reportSubType:a.reportTypes,reportSubTypeList:a.reportTypes}},parseItem:function(b,c){var d=this,e=a.map(c.Documents,function(a){return{docCategory:a.DocumentCategory,docSize:a.DocumentFileSize,docIcon:a.IconPath,docThumb:a.ThumbnailPath,docTitle:d._truncate(a.DocumentTitle,b.titleLength),docType:a.DocumentFileType,docUrl:a.DocumentPath}});return a.isArray(b.docCategories)&&b.docCategories.length&&(e=a.grep(e,function(c){return a.inArray(c.docCategory,b.docCategories)>-1})),{coverUrl:c.CoverImagePath,title:c.ReportTitle,fiscalYear:c.ReportYear,dateObj:new Date(c.ReportDate),year:new Date(c.ReportDate).getFullYear(),date:this._formatDate(c.ReportDate),tags:c.TagsList,type:c.ReportSubType,shortType:b.shortTypes[c.ReportSubType],docs:e}}},presentations:{itemsUrl:["/Services/PresentationService.svc/GetPresentationList","/feed/Presentation.svc/GetPresentationList"],yearsUrl:["/Services/PresentationService.svc/GetPresentationYearList","/feed/Presentation.svc/GetPresentationYearList"],itemsResultField:"GetPresentationListResult",yearsResultField:"GetPresentationYearListResult",buildParams:function(a){return{presentationSelection:a.showFuture&&!a.showPast?0:a.showPast&&!a.showFuture?1:3}},parseItem:function(a,b){return{title:this._truncate(b.Title,a.titleLength),url:b.LinkToDetailPage,dateObj:new Date(b.PresentationDate),year:new Date(b.PresentationDate).getFullYear(),date:this._formatDate(b.PresentationDate),tags:b.TagsList,body:this._truncate(b.Body,a.bodyLength),docUrl:b.DocumentPath,docSize:b.DocumentFileSize,docType:b.DocumentFileType,thumb:b.ThumbnailPath}}},news:{itemsUrl:["/Services/PressReleaseService.svc/GetPressReleaseList","/feed/PressRelease.svc/GetPressReleaseList"],yearsUrl:["/Services/PressReleaseService.svc/GetPressReleaseYearList","/feed/PressRelease.svc/GetPressReleaseYearList"],itemsResultField:"GetPressReleaseListResult",yearsResultField:"GetPressReleaseYearListResult",buildParams:function(a){var b=a.loadShortBody?a.loadBody?1:3:a.loadBody?2:0,c={pressReleaseCategoryWorkflowId:a.category};return a.usePublic?(c.bodyType=b,c.pressReleaseDateFilter=a.showFuture&&!a.showPast?0:a.showPast&&!a.showFuture?1:3):(c.pressReleaseBodyType=b,c.pressReleaseSelection=a.showFuture&&!a.showPast?0:a.showPast&&!a.showFuture?1:3),c},parseItem:function(b,c){return{title:this._truncate(c.Headline,b.titleLength),url:c.LinkToDetailPage,dateObj:new Date(c.PressReleaseDate),year:new Date(c.PressReleaseDate).getFullYear(),date:this._formatDate(c.PressReleaseDate),tags:c.TagsList,media:a.map(c.MediaCollection,function(a){return{alt:a.Alt,url:a.SourceUrl,type:a.Style,height:a.Height,width:a.Width}}),body:this._truncate(c.Body,b.bodyLength),shortBody:this._truncate(c.ShortBody,b.shortBodyLength),docUrl:c.DocumentPath,docSize:c.DocumentFileSize,docType:c.DocumentFileType,seoName:c.SeoName,thumb:c.ThumbnailPath||b.defaultThumb}}},sec:{itemsUrl:["/Services/SECFilingService.svc/GetEdgarFilingList","/feed/SECFiling.svc/GetEdgarFilingList"],yearsUrl:["/Services/SECFilingService.svc/GetEdgarFilingYearList","/feed/SECFiling.svc/GetEdgarFilingYearList"],itemsResultField:"GetEdgarFilingListResult",yearsResultField:"GetEdgarFilingYearListResult",buildParams:function(a){return{exchange:a.exchange,symbol:a.symbol,formGroupIdList:a.filingTypes.join(","),excludeNoDocuments:a.excludeNoDocuments}},parseItem:function(b,c){return{id:c.FilingId,description:this._truncate(c.FilingDescription,b.titleLength),url:c.LinkToDetailPage,dateObj:new Date(c.FilingDate),year:new Date(c.FilingDate).getFullYear(),date:this._formatDate(c.FilingDate),agent:c.FilingAgentName,person:c.ReportPersonName,type:c.FilingTypeMnemonic,docs:a.map(c.DocumentList,function(a){return{docType:a.DocumentType,docUrl:a.Url}})}}}}}),a.widget("q4.downloads",a.q4.api,{options:{template:"",downloadType:null}}),a.widget("q4.events",a.q4.api,{options:{template:""}}),a.widget("q4.financials",a.q4.api,{options:{reportTypes:[],docCategories:[],template:""},_sortItemsByType:function(b){var c=this.options,d=[],e={};return a.each(b,function(b,c){a.inArray(c.type,d)==-1&&(d.push(c.type),e[c.type]=[]),a.each(c.docs,function(a,b){e[c.type].push(b)})}),a.map(d,function(a,b){return{type:a,shortType:c.shortTypes[a],items:e[a]}})},_buildTemplateData:function(b){var c=this,d=this._super(b);return d.types=this._sortItemsByType(d.items),a.each(d.years,function(a,b){b.types=c._sortItemsByType(b.items)}),d}}),a.widget("q4.presentations",a.q4.api,{options:{template:""}}),a.widget("q4.news",a.q4.api,{options:{category:"00000000-0000-0000-0000-000000000000",loadBody:!0,loadShortBody:!0,template:""}}),a.widget("q4.sec",a.q4.api,{options:{exchange:"",symbol:"",filingTypes:[],excludeNoDocuments:!1,template:""}})}(jQuery);